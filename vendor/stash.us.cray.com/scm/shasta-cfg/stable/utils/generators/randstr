#!/bin/bash

ARGS=${1}
YQ=${2}
TEMP_DIR=${3}
OUT_FILE=${4}

# EXPECTED ARGS:
# name - name of field
# length - length of random string

LENGTH=$(echo $ARGS | $YQ r - 'length')

if [[ -z "LENGTH" ]]; then
    LENGTH="32"
fi

# Note: Wrap keys in [] to allow for periods.
KEY="data[$(echo $ARGS | $YQ r - 'name')]"
VALUE=$(openssl rand -hex $LENGTH)

$YQ w -i "$OUT_FILE" "$KEY" "$(echo -n "$VALUE" | base64)"
