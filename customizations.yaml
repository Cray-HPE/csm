apiVersion: customizations/v1
metadata:
  name: stable
spec:
  network:
    nmn: ~FIXME~ e.g., 10.252.0.0/17
    nmn_load_balancers: ~FIXME~ e.g., 10.92.100.0/24
    hmn: ~FIXME~ e.g., 10.254.0.0/17
    hmn_load_balancers: ~FIXME~ e.g., 10.94.100.0/24
    high_speed: ~FIXME~ e.g., 10.253.0.0/16
    netstaticips:
      site_to_system_lookups: ~FIXME~
      system_to_site_lookups: ~FIXME~ e.g., 172.30.84.40
      nmn_tftp: ~FIXME~ e.g., 10.92.100.60
      hmn_tftp: ~FIXME~ e.g., 10.94.100.60
      nmn_api_gw: ~FIXME~ e.g., 10.92.100.71
      nmn_unbound: ~FIXME~ e.g., 10.92.100.74
      nmn_api_gw_local: ~FIXME~ e.g., 10.92.100.81
      hmn_api_gw: ~FIXME~ e.g., 10.94.100.71
      nmn_ncn_masters:
        - ~FIXME~ e.g., 10.252.1.10
        - ~FIXME~ e.g., 10.252.1.11
        - ~FIXME~ e.g., 10.252.1.12
      nmn_ncn_storage:
        - ~FIXME~ e.g., 10.252.1.4
        - ~FIXME~ e.g., 10.252.1.5
        - ~FIXME~ e.g., 10.252.1.6
      nmn_ncn_storage_mons:
        - ~FIXME~ e.g., 10.252.1.4
        - ~FIXME~ e.g., 10.252.1.5
        - ~FIXME~ e.g., 10.252.1.6
    dns:
      external: ~FIXME~ e.g., eniac.dev.cray.com
      external_s3: ~FIXME~ e.g., s3.eniac.dev.cray.com
      external_auth: ~FIXME~ e.g., auth.eniac.dev.cray.com
      external_api: ~FIXME~ e.g., api.eniac.dev.cray.com
      internal_s3: ~FIXME~ e.g., rgw-vip.nmn
      internal_api: ~FIXME~ e.g., api-gw-service.nmn
      primary_server_name: ~FIXME~ e.g., primary
      secondary_servers: ~FIXME~ e.g., externaldns1.my.domain/1.1.1.1,externaldns2.my.domain/2.2.2.2
      notify_zones: ~FIXME~ e.g., shasta.dev.cray.com,8.101.10.in-addr.arpa
    metallb: ~FIXME~ e.g., generated by csi (peers/address-pools)
  wlm:
    cluster_name: ~FIXME~ e.g., eniac
    wlmstaticips:
      slurmctld: ~FIXME~ e.g., 10.252.2.3
      slurmdbd: ~FIXME~ e.g., 10.252.2.4
      pbs: ~FIXME~ e.g., 10.252.2.5
      pbs_comm: ~FIXME~ e.g., 10.252.2.6
    macvlansetup:
      nmn_subnet: ~FIXME~ e.g., 10.252.2.0/23
      nmn_supernet: ~FIXME~ e.g., 10.252.0.0/17
      nmn_supernet_gateway: ~FIXME~ e.g., 10.252.0.1
      nmn_reservation_start: ~FIXME~ e.g., 10.252.2.10
      nmn_reservation_end: ~FIXME~ e.g., 10.252.3.254
      # The following should be filled in by CSI generated routes to
      # to NMN subnets on which compute nodes reside.  These should
      # all be reached through the 'nmn_supernet_gateway' IP above.
      # If there is ever a local (i.e. 'nmn_supernet') route
      # destination in this list, it should be removed.
      routes: []
  proxiedWebAppExternalHostnames:
    customerManagement:
      - '{{ kubernetes.services[''gatekeeper-policy-manager''][''gatekeeper-policy-manager''].externalAuthority }}'
      - '{{ kubernetes.services[''cray-istio''].istio.tracing.externalAuthority }}'
      - '{{ kubernetes.services[''cray-kiali''].externalAuthority }}'
      - '{{ kubernetes.services[''cray-sysmgmt-health''][''kube-prometheus-stack''].prometheus.prometheusSpec.externalAuthority }}'
      - '{{ kubernetes.services[''cray-sysmgmt-health''][''kube-prometheus-stack''].alertmanager.alertmanagerSpec.externalAuthority }}'
      - '{{ kubernetes.services[''cray-sysmgmt-health''][''kube-prometheus-stack''].grafana.externalAuthority }}'
      - '{{ kubernetes.services[''cray-sysmgmt-health''][''kube-prometheus-stack''].thanos.thanosSpec.externalAuthority }}'
      - '{{ kubernetes.services.gitea.externalHostname }}'
      - '{{ kubernetes.services[''cray-nls''].externalHostname }}'
      - sma-grafana.cmn.{{ network.dns.external }}
      - sma-kibana.cmn.{{network.dns.external}}
      - sma-dashboards.cmn.{{network.dns.external}}
      - sma-pcim.cmn.{{network.dns.external}}
      - csms.cmn.{{ network.dns.external }}
      - argo.cmn.{{ network.dns.external }}
      - ara.cmn.{{ network.dns.external }}
    customerAccess:
      - capsules.can.{{ network.dns.external }}
    customerHighSpeed:
      - capsules.chn.{{ network.dns.external }}
  kubernetes:
    # These are sealed secrets that HPE WILL overwrite during migrations.
    # Customer changes will be lost.
    tracked_sealed_secrets:
      - cray_reds_credentials
      - cray_meds_credentials
      - cray_hms_rts_credentials
    # NOTE: These are not automatically deployed to kubernetes, they are meant
    # to be included within the `services` section of different charts
    sealed_secrets:
      cray-keycloak:
        generate:
          name: keycloak-certs
          data:
            - type: static_b64
              args:
                name: certs.jks
                value: /u3+7QAAAAIAAAAA5yXvSDt11bGXyBA9M2iy0/5i1Tg=
      keycloak_master_admin_auth:
        generate:
          name: keycloak-master-admin-auth
          data:
            - type: static
              args:
                name: client-id
                value: admin-cli
            - type: static
              args:
                name: user
                value: admin
            - type: randstr
              args:
                name: password
                length: 32
            - type: static
              args:
                name: internal_token_url
                value: https://api-gw-service-nmn.local/keycloak/realms/master/protocol/openid-connect/token
      cray_reds_credentials:
        generate:
          name: cray-reds-credentials
          data:
            - type: static
              args:
                name: vault_redfish_defaults
                value: '{"Cray": {"Username": "root", "Password": "XXXX"}}'
            - type: static
              args:
                name: vault_switch_defaults
                value: '{"SNMPUsername": "testuser", "SNMPAuthPassword": "XXXX", "SNMPPrivPassword": "XXXX"}'
      cray_meds_credentials:
        generate:
          name: cray-meds-credentials
          data:
            - type: static
              args:
                name: vault_redfish_defaults
                value: '{"Username": "root", "Password": "XXXX"}'
      cray_hms_rts_credentials:
        generate:
          name: cray-hms-rts-credentials
          data:
            - type: static
              args:
                name: vault_pdu_defaults
                value: '{"Username": "admn", "Password": "XXXX"}'
            - type: static
              args:
                name: vault_rts_defaults
                value: '{"Username": "root", "Password": "XXXX"}'
      gitea:
        generate:
          name: vcs-user-credentials
          data:
            - type: randstr
              args:
                name: vcs_password
                length: 32
                url_safe: yes
                encoding: base64
            - type: static
              args:
                name: vcs_username
                value: crayvcs
      gen_platform_ca_1:
        generate:
          name: generated-platform-ca-1
          data:
            - type: platform_ca
              args:
                root_days: 3651
                int_days: 3650
                root_cn: Platform CA
                int_cn: Platform CA - L1
      pals:
        generate:
          name: pals-config
          data:
            - type: zmq_curve
              args:
                pub_name: client_key.pub
                key_name: client_key
            - type: zmq_curve
              args:
                pub_name: server_key.pub
                key_name: server_key
      powerdns:
        generate:
          name: cray-powerdns-credentials
          data:
            - type: randstr
              args:
                name: pdns_api_key
                length: 32
      dnssec:
        generate:
          name: dnssec-keys
          data:
            - type: static_b64
              args:
                name: dummy
                value: ZHVtbXkK
      munge:
        generate:
          name: munge-secret
          data:
            - type: randstr
              args:
                name: munge.key
                length: 1024
      slurmdb:
        generate:
          name: slurmdb-secret
          data:
            - type: static
              args:
                name: MYSQL_USER
                value: slurm
            - type: static
              args:
                name: MYSQL_DATABASE
                value: slurm_acct_db
            - type: randstr
              args:
                name: MYSQL_ROOT_PASSWORD
                length: 32
            - type: randstr
              args:
                name: MYSQL_PASSWORD
                length: 32
      keycloak_users_localize:
        generate:
          name: keycloak-users-localize
          data:
            - type: static
              args:
                name: ldap_connection_url
                value: ""
      cray-oauth2-proxy-customer-management:
        generate:
          name: cray-oauth2-proxy-customer-management
          data:
            - type: randstr
              args:
                name: cookie-secret
                length: 32
                encoding: base64
                url_safe: yes
      cray-oauth2-proxy-customer-access:
        generate:
          name: cray-oauth2-proxy-customer-access
          data:
            - type: randstr
              args:
                name: cookie-secret
                length: 32
                encoding: base64
                url_safe: yes
      cray-oauth2-proxy-customer-high-speed:
        generate:
          name: cray-oauth2-proxy-customer-high-speed
          data:
            - type: randstr
              args:
                name: cookie-secret
                length: 32
                encoding: base64
                url_safe: yes
      nexus-admin-credential:
        generate:
          name: nexus-admin-credential
          data:
            - type: static
              args:
                name: username
                value: admin
            - type: randstr
              args:
                name: password
                length: 32
                encoding: base64
                url_safe: yes
    services:
      # Strive for readability. Keep services lexicographically sorted by chart
      # name. Seperate chart customizations by a blank line.
      cray-externaldns:
        external-dns:
          domainFilters:
            - '.{{ network.dns.external }}'
      cray-dns-unbound:
        domain_name: '{{ network.dns.external }}'
        forwardZones:
          - name: "."
            forwardIps:
              - "{{ network.netstaticips.system_to_site_lookups }}"
      cray-hms-badger-loader:
        nexus:
          repo: csm-diags
      cray-hms-badger-service:
        luspath: "/lus/csm-diags"
        wlm: "SLURM"
      cray-hms-badger-job-api:
        luspath: "/lus/csm-diags"
        wlm: "SLURM"
      cray-hms-firmware-action:
        nexus:
          repo: shasta-firmware
      cray-hms-hmcollector:
        hmcollector_external_ip: '{{ network.netstaticips.hmn_api_gw }}'
        hmcollector_external_hostname: 'hmcollector.hmnlb.{{ network.dns.external }}'
      cray-hms-meds:
        ntpserver_host: time-hmn:123
        ntpserver_host_use_ip: ""
        syslogserver_host: rsyslog-aggregator.hmnlb:514
        syslogserver_host_use_ip: "y"
        # Default root SSH key to nothing, will cause MEDS to ignore it.
        vault_root_ssh_key: ""
        cray-service:
          sealedSecrets:
            - '{{ kubernetes.sealed_secrets.cray_meds_credentials | toYaml }}'
      cray-hms-rts:
        cray-service:
          sealedSecrets:
            - '{{ kubernetes.sealed_secrets.cray_hms_rts_credentials | toYaml }}'
      cray-ims:
        keycloak:
          keycloak_admin_client_auth_secret_name: admin-client-auth
        customer_access:
          access_pool: customer-management
          shasta_domain: '{{ network.dns.external }}'
        api_gw:
          api_gw_service_name: istio-ingressgateway
          api_gw_service_namespace: istio-system
      cray-istio:
        # Override for the ingress-gateway certificate (requested from
        # cert-manager). The list of master nodes must be reviewed and
        # updated per system until a source exists from which to dynamically
        # source them.
        certificate:
          dnsNames:
            - ncn-m001.local
            - ncn-m002.local
            - ncn-m003.local
            - registry.local
            - packages.local
            - api_gw_service.local
            - api_gw_service-nmn.local
            - api-gw-service.local
            - api-gw-service-nmn.local
            - istio-ingressgateway.istio-system.svc.cluster.local
            - istio-ingressgateway-cmn.istio-system.svc.cluster.local
            - '*.cmn.{{ network.dns.external }}'
            - '*.can.{{ network.dns.external }}'
            - '*.chn.{{ network.dns.external }}'
            - '*.nmn.{{ network.dns.external }}'
            - '*.hmn.{{ network.dns.external }}'
            - '*.nmnlb.{{ network.dns.external }}'
            - '*.hmnlb.{{ network.dns.external }}'
            - '*.{{ network.dns.external }}'
          commonName: '{{ network.dns.external }}'
        authn:
          enabled: true
        servicesGateway:
          tls: true
          redirect: true
        services:
          istio-ingressgateway:
            loadBalancerIP: '{{ network.netstaticips.nmn_api_gw }}'
            serviceAnnotations:
              metallb.universe.tf/address-pool: node-management
              external-dns.alpha.kubernetes.io/hostname: 'api.nmnlb.{{ network.dns.external }},auth.nmnlb.{{ network.dns.external }}'
          istio-ingressgateway-hmn:
            loadBalancerIP: '{{ network.netstaticips.hmn_api_gw }}'
            serviceAnnotations:
              metallb.universe.tf/address-pool: hardware-management
              external-dns.alpha.kubernetes.io/hostname: 'api.hmnlb.{{ network.dns.external }},auth.hmnlb.{{ network.dns.external }},hmcollector.hmnlb.{{ network.dns.external }}'
          istio-ingressgateway-can:
            serviceAnnotations:
              metallb.universe.tf/address-pool: customer-access
              external-dns.alpha.kubernetes.io/hostname: 'api.can.{{ network.dns.external }},auth.can.{{ network.dns.external }}'
          istio-ingressgateway-cmn:
            serviceAnnotations:
              metallb.universe.tf/address-pool: customer-management
              external-dns.alpha.kubernetes.io/hostname: 'api.cmn.{{ network.dns.external }},auth.cmn.{{ network.dns.external }},nexus.cmn.{{ network.dns.external }}'
          istio-ingressgateway-chn:
            serviceAnnotations:
              metallb.universe.tf/address-pool: customer-high-speed
              external-dns.alpha.kubernetes.io/hostname: 'api.chn.{{ network.dns.external }},auth.chn.{{ network.dns.external }}'
          istio-ingressgateway-local:
            loadBalancerIP: '{{ network.netstaticips.nmn_api_gw_local }}'
            serviceAnnotations:
              metallb.universe.tf/address-pool: node-management
        istio:
          tracing:
            externalAuthority: jaeger-istio.cmn.{{ network.dns.external }}
      cray-keycloak:
        sealedSecrets:
          - '{{ kubernetes.sealed_secrets[''cray-keycloak''] | toYaml }}'
          - '{{ kubernetes.sealed_secrets.keycloak_master_admin_auth | toYaml }}'
        setup:
          keycloak:
            customerAccessUrl: https://auth.cmn.{{ network.dns.external }}/keycloak
            gatekeeper:
              proxiedHosts: '{{ proxiedWebAppExternalHostnames.customerManagement }}'
            clients:
              oauth2-proxy-customer-management:
                proxiedHosts: '{{ proxiedWebAppExternalHostnames.customerManagement }}'
              oauth2-proxy-customer-access:
                proxiedHosts: '{{ proxiedWebAppExternalHostnames.customerAccess }}'
              oauth2-proxy-customer-high-speed:
                proxiedHosts: '{{ proxiedWebAppExternalHostnames.customerHighSpeed }}'
            service: keycloak.services
            clusterGw:
              route: /keycloak
              dnsName: '{{ network.dns.internal_api }}'
        internalTokenUrl: https://{{ network.dns.internal_api }}/keycloak/realms/master/protocol/openid-connect/token
      cray-kiali:
        externalAuthority: kiali-istio.cmn.{{ network.dns.external }}
        kiali-operator:
          cr:
            spec:
              external_services:
                grafana:
                  url: https://{{ kubernetes.services['cray-sysmgmt-health']['kube-prometheus-stack'].grafana.externalAuthority }}/
      cray-metallb:
        metallb:
          configInline: '{{ network.metallb | toYaml }}'
      cray-munge:
        sealedSecrets:
          - '{{ kubernetes.sealed_secrets.munge | toYaml }}'
      cray-munge-services:
        sealedSecrets:
          - '{{ kubernetes.sealed_secrets.munge | toYaml }}'
      cray-nexus:
        istio:
          ingress:
            hosts:
              ui:
                enabled: true
                authority: nexus.cmn.{{ network.dns.external }}
        sealedSecrets:
          - '{{ kubernetes.sealed_secrets[''nexus-admin-credential''] | toYaml }}'
      cray-node-discovery:
        networks:
          node_management:
            blocks:
              ipv4:
                - label: river
                  network: '{{ network.nmn }}'
          hardware_management:
            blocks:
              ipv4:
                - label: river
                  network: '{{ network.hmn }}'
      cray-oauth2-proxies:
        customer-management:
          sealedSecrets:
            - '{{ kubernetes.sealed_secrets[''cray-oauth2-proxy-customer-management''] | toYaml }}'
          hostAliases:
            - ip: '{{ network.netstaticips.nmn_api_gw }}'
              hostnames:
                - 'auth.cmn.{{ network.dns.external }}'
          hosts: '{{ proxiedWebAppExternalHostnames.customerManagement }}'
        customer-access:
          sealedSecrets:
            - '{{ kubernetes.sealed_secrets[''cray-oauth2-proxy-customer-access''] | toYaml }}'
          hostAliases:
            - ip: '{{ network.netstaticips.nmn_api_gw }}'
              hostnames:
                - 'auth.cmn.{{ network.dns.external }}'
          hosts: '{{ proxiedWebAppExternalHostnames.customerAccess }}'
        customer-high-speed:
          sealedSecrets:
            - '{{ kubernetes.sealed_secrets[''cray-oauth2-proxy-customer-high-speed''] | toYaml }}'
          hostAliases:
            - ip: '{{ network.netstaticips.nmn_api_gw }}'
              hostnames:
                - 'auth.cmn.{{ network.dns.external }}'
          hosts: '{{ proxiedWebAppExternalHostnames.customerHighSpeed }}'
      cray-powerdns-manager:
        manager:
          primary_server: "{{ network.dns.primary_server_name }}/{{ network.netstaticips.site_to_system_lookups }}"
          secondary_servers: "{{ network.dns.secondary_servers }}"
          base_domain: "{{ network.dns.external }}"
          notify_zones: "{{ network.dns.notify_zones }}"
        cray-service:
          sealedSecrets:
            - '{{ kubernetes.sealed_secrets.dnssec | toYaml }}'
      cray-sssd:
        domains:
          - name: Cray_DC
            ldapSchema: rfc2307
            ldapURI: ldaps://dcldap2.us.cray.com,ldaps://dcldap3.us.cray.com
            ldapSearchBase: dc=dcldap,dc=dit
            ldapTLSReqcert: allow
      cray-slurmdbd:
        sealedSecrets:
          - '{{ kubernetes.sealed_secrets.slurmdb | toYaml }}'
        slurmdbd:
          ip: '{{ wlm.wlmstaticips.slurmdbd }}'
        macvlan:
          subnet: '{{ wlm.macvlansetup.nmn_supernet }}'
          routes: '{{ wlm.macvlansetup.routes }}'
          master: '{{ wlm.macvlansetup.nmn_vlan }}'
      cray-slurmctld:
        clusterName: '{{ wlm.cluster_name }}'
        macvlan:
          ip: '{{ wlm.wlmstaticips.slurmctld }}'
          subnet: '{{ wlm.macvlansetup.nmn_supernet }}'
          routes: '{{ wlm.macvlansetup.routes }}'
          master: '{{ wlm.macvlansetup.nmn_vlan }}'
      slurm-config:
        cluster_name: '{{ wlm.cluster_name }}'
        slurmctld_ip: '{{ wlm.wlmstaticips.slurmctld }}'
        slurmdbd_ip: '{{ wlm.wlmstaticips.slurmdbd }}'
      cray-sysmgmt-health:
        kube-prometheus-stack:
          kubeEtcd:
            endpoints: '{{ network.netstaticips.nmn_ncn_masters }}'
          prometheus:
            prometheusSpec:
              externalAuthority: prometheus.cmn.{{ network.dns.external }}
              externalUrl: https://{{ kubernetes.services['cray-sysmgmt-health']['kube-prometheus-stack'].prometheus.prometheusSpec.externalAuthority }}/
          alertmanager:
            alertmanagerSpec:
              externalAuthority: alertmanager.cmn.{{ network.dns.external }}
              externalUrl: https://{{ kubernetes.services['cray-sysmgmt-health']['kube-prometheus-stack'].alertmanager.alertmanagerSpec.externalAuthority }}/
          grafana:
            externalAuthority: grafana.cmn.{{ network.dns.external }}
            # Skip plugin installation for airgaped systems.
            # If the system is non airgaped then you can comment out or remove plugins property.
            plugins: ""
          thanos:
            thanosSpec:
              externalAuthority: thanos.cmn.{{ network.dns.external }}
              externalUrl: https://{{ kubernetes.services['cray-sysmgmt-health']['kube-prometheus-stack'].thanos.thanosSpec.externalAuthority }}/
            s3_endpoint: '{{network.dns.internal_s3 }}'
        cephExporter:
          endpoints: '{{ network.netstaticips.nmn_ncn_storage_mons }}'
        cephNodeExporter:
          endpoints: '{{ network.netstaticips.nmn_ncn_storage }}'
          enabled: true
      cray-hms-discovery:
        sealedSecrets:
          - '{{ kubernetes.sealed_secrets.cray_reds_credentials | toYaml }}'
      cray-rm-pals:
        cray-service:
          sealedSecrets:
            - '{{ kubernetes.sealed_secrets.pals | toYaml }}'
      cray-s3:
        service:
          annotations:
            external-dns.alpha.kubernetes.io/hostname: 's3.cmn.{{ network.dns.external }}'
        rgw:
          ips: '{{ network.netstaticips.nmn_ncn_storage }}'
      cray-tftp:
        storage_shared_class_cray_tftp: ceph-cephfs-external
        storage_shared_size_cray_tftp: 5Gi
        nmn_tftp_service_ip: '{{ network.netstaticips.nmn_tftp }}'
        hmn_tftp_service_ip: '{{ network.netstaticips.hmn_tftp }}'
      cray-uas-mgr:
        uasConfig:
          uai_macvlan_interface: '{{ wlm.macvlansetup.nmn_vlan }}'
          uai_macvlan_network: '{{ wlm.macvlansetup.nmn_supernet }}'
          uai_macvlan_range_start: '{{ wlm.macvlansetup.nmn_reservation_start }}'
          uai_macvlan_range_end: '{{ wlm.macvlansetup.nmn_reservation_end }}'
          uai_macvlan_routes: '{{ wlm.macvlansetup.routes }}'
          uas_ssh_lb_pool: customer-access
          require_bican: false
          dns_domain: '{{ network.dns.external }}'
          images:
            images:
              - cray/cray-uai-sles15sp1:latest
            defaultImage: cray/cray-uai-sles15sp1:latest
      cray-vault:
        sealedSecrets:
          - '{{ kubernetes.sealed_secrets.gen_platform_ca_1 | toYaml }}'
        pki:
          customCA:
            enabled: true
            secret: generated-platform-ca-1
            private_key: int_ca.key
            certificate: int_ca.crt
            ca_bundle: root_ca.crt
      cfs-ara:
        externalHostname: ara.cmn.{{ network.dns.external }}
      gitea:
        uriPrefix: /vcs
        externalHostname: vcs.cmn.{{ network.dns.external }}
        cray-service:
          sealedSecrets:
            - '{{ kubernetes.sealed_secrets.gitea | toYaml }}'
      capsules-warehouse-server:
        config:
          server:
            authJwksUrl: http://cray-keycloak-http.services.svc.cluster.local/keycloak/realms/shasta/protocol/openid-connect/certs
      capsules-dispatch-server:
        config:
          server:
            authJwksUrl: http://cray-keycloak-http.services.svc.cluster.local/keycloak/realms/shasta/protocol/openid-connect/certs
      sma-zk-kafka:
        kafkaPVCSize: 65Gi
        zkPVCSize: 1Gi
        storageClass: sma-block-replicated
        kafkaReqCPU: "5"
        kafkaReqMem: 6Gi
        javaMinHeapSize: 5g
      sma-postgres-cluster:
        pgReqMem: 4Gi
        pgReqCPU: "2"
        volume:
          size: 1.6Ti
          storageClass: sma-block-replicated
      sma-pgdb-cron:
        pg_retention_duration: 7
        pg_action_decimal: 0.94
        pg_safemax_decimal: 0.89
      sma-mariadb:
        mysqlPVC:
          storage: 5Gi
          storageClass: sma-block-replicated
      sma-elasticsearch:
        esJavaOpts: -Xmx30g -Xms30g
        resources:
          requests:
            cpu: "4"
            memory: 16Gi
        volumeClaimTemplate:
          storageClassName: sma-block-replicated
          resources:
            requests:
              storage: 188Gi
      sma-opensearch:
        esJavaOpts: -Xmx30g -Xms30g
        resources:
          requests:
            cpu: "4"
            memory: 16Gi
        volumeClaimTemplate:
          storageClassName: sma-block-replicated
          resources:
            requests:
              storage: 188Gi
      sma-es-curator:
        es_max_index_age: 7
        es_disk_highwater: 95
        es_disk_lowwater: 90
        es_disk_minimum_indices: 3
      sma-rsyslog-aggregator:
        replicaCount: 3
        cray-service:
          service:
            loadBalancerIP: 10.92.100.72
          volumeClaimTemplate:
            storageClassName: sma-block-replicated
            resources:
              requests:
                storage: 16Gi
        rsyslogAggregatorCmn:
          externalHostname: rsyslog.cmn.{{ network.dns.external }}
        rsyslogAggregatorHmn:
          service:
            loadBalancerIP: 10.94.100.72
      sma-rsyslog-aggregator-udp:
        replicaCount: 3
        cray-service:
          service:
            loadBalancerIP: 10.92.100.72
          volumeClaimTemplate:
            storageClassName: sma-block-replicated
            resources:
              requests:
                storage: 16Gi
        rsyslogAggregatorCmn:
          externalHostname: rsyslog.cmn.{{ network.dns.external }}
        rsyslogAggregatorUdpHmn:
          service:
            loadBalancerIP: 10.94.100.72
      sma-kibana:
        externalAuthority: sma-kibana.cmn.{{ network.dns.external }}
        cray-service:
          containers:
            sma-kibana:
              resources:
                requests:
                  cpu: "1"
                  memory: 2Gi
      sma-opensearch-dashboards:
        externalAuthority: sma-dashboards.cmn.{{ network.dns.external }}
        cray-service:
          containers:
            sma-dashboards:
              resources:
                requests:
                  cpu: "1"
                  memory: 2Gi
      sma-pcim:
        externalAuthority: sma-pcim.cmn.{{ network.dns.external }}
        cray-service:
          containers:
            sma-pcim:
              resources:
                requests:
                  cpu: "1"
                  memory: 2Gi
      sma-grafana:
        externalAuthority: sma-grafana.cmn.{{ network.dns.external }}
        cray-service:
          containers:
            sma-grafana:
              resources:
                requests:
                  cpu: "1"
                  memory: 2Gi
      sma-monasca:
        mysql:
          persistence:
            storageClass: sma-block-replicated
            size: 5Gi
      sma-ldms-config:
        pvcs:
          ldmsComputeAggrPVC:
            storageClass: ceph-cephfs-external
          ldmsComputeSmplPVC:
            storageClass: ceph-cephfs-external
          ldmsSmsAggrPvc:
            storageClass: ceph-cephfs-external
          ldmsSmsSmplPVC:
            storageClass: ceph-cephfs-external
          ldmsSmplPVC:
            storageClass: ceph-cephfs-external
        no_ncn_storage_flag: true
      cray-pbs:
        pbs:
          ip: '{{ wlm.wlmstaticips.pbs }}'
        comm:
          ip: '{{ wlm.wlmstaticips.pbs_comm }}'
        macvlan:
          subnet: '{{ wlm.macvlansetup.nmn_supernet }}'
          routes: '{{ wlm.macvlansetup.routes }}'
          master: '{{ wlm.macvlansetup.nmn_vlan }}'
        #
        # Node label(s) take the form:
        #
        # - <node>:<key>=<value>:<key2>=<value2>...
        #
        nodeLabels:
          - ncn-m001:no_external_access=False
          - ncn-m002:no_external_access=True
          - ncn-m003:no_external_access=True
          - ncn-w001:no_external_access=False
          - ncn-w002:no_external_access=False
          - ncn-w003:no_external_access=False
      cray-opa:
        ingresses:
          ingressgateway:
            issuers:
              shasta-nmn: https://api.nmnlb.{{ network.dns.external }}/keycloak/realms/shasta
              keycloak-nmn: https://auth.nmnlb.{{ network.dns.external }}/keycloak/realms/shasta
          ingressgateway-customer-admin:
            issuers:
              shasta-cmn: https://api.cmn.{{ network.dns.external }}/keycloak/realms/shasta
              keycloak-cmn: https://auth.cmn.{{ network.dns.external }}/keycloak/realms/shasta
          ingressgateway-customer-user:
            issuers:
              shasta-can: https://api.can.{{ network.dns.external }}/keycloak/realms/shasta
              keycloak-can: https://auth.can.{{ network.dns.external }}/keycloak/realms/shasta
              shasta-chn: https://api.chn.{{ network.dns.external }}/keycloak/realms/shasta
              keycloak-chn: https://auth.chn.{{ network.dns.external }}/keycloak/realms/shasta
          ingressgateway-hmn:
            issuers:
              shasta-hmn: https://api.hmnlb.{{ network.dns.external }}/keycloak/realms/shasta
              keycloak-hmn: https://auth.hmnlb.{{ network.dns.external }}/keycloak/realms/shasta
      spire:
        trustDomain: shasta
        server:
          fqdn: spire.local
      cray-keycloak-users-localize:
        sealedSecrets:
          - '{{ kubernetes.sealed_secrets.keycloak_users_localize | toYaml }}'
      cray-hms-bss:
        addvertisAddress: http://{{ network.netstaticips.nmn_api_gw_local }}:8888
        cray-service:
          containers:
            cray-bss:
              env:
              - name: HSM_URL
                value: http://cray-smd
              - name: NFD_URL
                value: http://cray-hmnfd
              - name: SPIRE_TOKEN_URL
                value: https://cray-spire-tokens.spire:54440
              - name: S3_ENDPOINT
                valueFrom:
                  secretKeyRef:
                    key: http_s3_endpoint
                    name: bss-s3-credentials
              - name: S3_BUCKET
                value: boot-image
              - name: S3_ACCESS_KEY
                valueFrom:
                  secretKeyRef:
                    key: access_key
                    name: bss-s3-credentials
              - name: S3_SECRET_KEY
                valueFrom:
                  secretKeyRef:
                    key: secret_key
                    name: bss-s3-credentials
              - name: BSS_ADVERTISE_ADDRESS
                valueFrom:
                  configMapKeyRef:
                    key: addvertisAddress
                    name: bss-env-config
      gatekeeper-policy-manager:
        gatekeeper-policy-manager:
          externalAuthority: opa-gpm.cmn.{{ network.dns.external }}
          externalUrl: https://{{ kubernetes.services['gatekeeper-policy-manager']['gatekeeper-policy-manager'].externalAuthority }}/
      cray-dns-powerdns:
        service:
          cmn:
            loadBalancerIP: '{{ network.netstaticips.site_to_system_lookups }}'
        cray-service:
          sealedSecrets:
            - '{{ kubernetes.sealed_secrets.powerdns | toYaml }}'
      cray-nls:
        externalHostname: "cmn.{{ network.dns.external }}"
